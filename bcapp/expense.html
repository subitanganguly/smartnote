<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Expenses - Barman Construction</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="style/style.css" rel="stylesheet">
</head>
<body>

<!-- Navbar placeholder -->
<div id="nav-placeholder"></div>

<!-- Add Expense Modal -->
<div class="modal fade" id="addExpenseModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Expense</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="expenseForm">
                    <div class="mb-3">
                        <label for="expenseTitle" class="form-label">Expense Title *</label>
                        <input type="text" class="form-control" id="expenseTitle" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="expenseAmount" class="form-label">Amount *</label>
                        <div class="input-group">
                            <span class="input-group-text">₹</span>
                            <input type="number" class="form-control" id="expenseAmount" step="0.01" min="0" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="expenseDate" class="form-label">Date *</label>
                        <input type="date" class="form-control" id="expenseDate" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="expenseRemarks" class="form-label">Remarks</label>
                        <textarea class="form-control" id="expenseRemarks" rows="3"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label for="expenseProject" class="form-label">Project *</label>
                        <select class="form-select" id="expenseProject" required>
                            <option value="">Select Project</option>
                        </select>
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveExpense()">Save Expense</button>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="content p-1">
    <div class="container-fluid">
        
        <!-- Page Header -->
          <div class="d-flex justify-content-between align-items-center mb-1 p-2">
        <h4 class="text-nowrap top-h">
        <span class="d-none d-lg-inline"><i class="fas fa-receipt"></i> Project Expenses</span>
        </h4>
        <button class="btn button2" data-bs-toggle="modal" data-bs-target="#addExpenseModal">
        <i class="fas fa-plus"></i><span class="d-none d-lg-inline"> Add Expense</span>
        </button>
         </div>

        <!-- Stats Cards -->
        <div class="row mb-4 g-1">

    <div class="col-4">
        <div class="card border-start border-primary border-1 h-100">
            <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1 small">Total Expenses</h6>
                        <h6 class="mb-0 fw-semibold" id="totalExpenses">₹ 0</h6>
                    </div>
                    <div class="bg-primary px-2 py-1 rounded">
                        <i class="fas fa-receipt fa-sm text-white"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-4">
        <div class="card border-start border-success border-1 h-100">
            <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1 small">This Month</h6>
                        <h6 class="mb-0 fw-semibold" id="monthlyExpenses">₹ 0</h6>
                    </div>
                    <div class="bg-success px-2 py-1 rounded">
                        <i class="fas fa-calendar-alt fa-sm text-white"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-4">
        <div class="card border-start border-info border-1 h-100">
            <div class="card-body p-2">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-muted mb-1 small">Today</h6>
                        <h6 class="mb-0 fw-semibold" id="todayExpenses">₹ 0</h6>
                    </div>
                    <div class="bg-info px-2 py-1 rounded">
                        <i class="fas fa-coins fa-sm text-white"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


        <!-- Filters Section -->
        <div class="fix-card mb-2 p-2">
                <div class="card-header">
                <h5 class="card-title mb-3">Filters</h5>
                </div>
                <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-3">
                        <label for="filterProject" class="form-label">Project</label>
                        <select class="form-select form-select-sm form-select-md" id="filterProject">
                            <option value="">All Projects</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3">
                        <label for="filterCategory" class="form-label">Category</label>
                        <select class="form-select form-select-sm form-select-md" id="filterCategory">
                            <option value="">All Categories</option>
                            <option value="material">Material</option>
                            <option value="labor">Labor</option>
                            <option value="equipment">Equipment</option>
                            <option value="transport">Transport</option>
                            <option value="utility">Utilities</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="office">Office</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3">
                        <label for="filterDateFrom" class="form-label">Date From</label>
                        <input type="date" class="form-control form-control-sm form-control-md" id="filterDateFrom">
                    </div>
                    
                    <div class="col-md-3">
                        <label for="filterDateTo" class="form-label">Date To</label>
                        <input type="date" class="form-control form-control-sm form-control-md" id="filterDateTo">
                    </div>
                    
                    <div class="col-md-12 d-flex align-items-end">
                        <button class="btn btn-primary me-2" onclick="applyFilters()">
                            <i class="fas fa-filter me-1"></i>Apply Filters
                        </button>
                        <button class="btn btn-outline-secondary" onclick="resetFilters()">
                            <i class="fas fa-redo me-1"></i>Reset
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Expenses List -->
        <div class="mb-2">
            <div class="card-header d-flex justify-content-between align-items-center">
                <p class="mb-0">Expenses List</p>
                <div>
                    <button class="btn btn-outline-success btn-sm me-2" onclick="exportToExcel()">
                        <i class="fas fa-file-excel me-1"></i>Export
                    </button>
                    <button class="btn btn-outline-info btn-sm" onclick="refreshExpenses()">
                        <i class="fas fa-sync-alt me-1"></i>Refresh
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div id="expensesList">
                    <div class="text-center py-5">
                        <section class="loader">
                        <div class="slider" style="--i:0"></div>
                        <div class="slider" style="--i:1"></div>
                        <div class="slider" style="--i:2"></div>
                        <div class="slider" style="--i:3"></div>
                        <div class="slider" style="--i:4"></div>
                        </section>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="js/firebaseconfig.js"></script>
<script src="js/all.js"></script>

<script>
    // Initialize Firebase
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }

    const auth = firebase.auth();
    const database = firebase.database();
    let currentUser = null;
    let currentUserRole = 'user';
    let allProjects = [];
    let expenses = [];
    let filteredExpenses = [];
    let currentFilters = {};

    // Check authentication
    auth.onAuthStateChanged(async (user) => {
        if (!user) {
            window.location.href = "login.html";
        } else {
            currentUser = user;
            await initializePage();
        }
    });

    // Initialize page
    async function initializePage() {
        try {
            // Get user role
            const userSnapshot = await database.ref(`users/${currentUser.uid}`).once('value');
            const userData = userSnapshot.val();
            currentUserRole = userData?.role || 'user';

            // Load projects
            await loadProjects();
            
            // Set default date in form
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('expenseDate').value = today;
            
            // Load expenses
            await loadExpenses();
            
            // Setup event listeners
            setupEventListeners();
            
            // Update stats
            updateStats();

        } catch (error) {
            console.error("Error initializing page:", error);
            showNotification('Error loading page: ' + error.message, 'danger');
        }
    }

    // Load projects
    async function loadProjects() {
        try {
            const expenseProject = document.getElementById('expenseProject');
            const filterProject = document.getElementById('filterProject');
            
            if (currentUserRole === 'admin') {
                const snapshot = await database.ref('projects').once('value');
                const allProjectsData = snapshot.val();
                
                if (allProjectsData) {
                    allProjects = [];
                    Object.keys(allProjectsData).forEach(projectId => {
                        allProjects.push({
                            id: projectId,
                            name: allProjectsData[projectId].projectName || 'Unnamed Project'
                        });
                    });
                }
            } else {
                const userSnapshot = await database.ref(`users/${currentUser.uid}`).once('value');
                const userData = userSnapshot.val();
                const userProjects = userData?.projects || {};
                
                allProjects = [];
                const projectIds = Object.keys(userProjects).filter(
                    projectId => userProjects[projectId] === true
                );
                
                for (const projectId of projectIds) {
                    const projectSnap = await database.ref(`projects/${projectId}`).once('value');
                    if (projectSnap.exists()) {
                        const projectData = projectSnap.val();
                        allProjects.push({
                            id: projectId,
                            name: projectData.projectName || 'Unnamed Project'
                        });
                    }
                }
            }

            // Populate both select elements
            expenseProject.innerHTML = '<option value="">Select Project</option>';
            filterProject.innerHTML = '<option value="">All Projects</option>';
            
            allProjects.forEach(project => {
                // For expense form
                const option1 = document.createElement('option');
                option1.value = project.id;
                option1.textContent = project.name;
                expenseProject.appendChild(option1);
                
                // For filter
                const option2 = document.createElement('option');
                option2.value = project.id;
                option2.textContent = project.name;
                filterProject.appendChild(option2);
            });

        } catch (error) {
            console.error("Error loading projects:", error);
            showNotification('Error loading projects: ' + error.message, 'warning');
        }
    }

    // Setup event listeners
    function setupEventListeners() {
        // Form submission
        document.getElementById('addExpenseModal').addEventListener('shown.bs.modal', function () {
            document.getElementById('expenseTitle').focus();
        });

        document.getElementById('addExpenseModal').addEventListener('hidden.bs.modal', function () {
            document.getElementById('expenseForm').reset();
            document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
        });

        // Filter change events
        ['filterProject', 'filterCategory', 'filterDateFrom', 'filterDateTo'].forEach(id => {
            document.getElementById(id).addEventListener('change', function() {
                applyFilters();
            });
        });
    }

    // Load expenses from projects structure
    async function loadExpenses() {
        try {
            const expensesList = document.getElementById('expensesList');
            expensesList.innerHTML = `
                <div class="text-center py-5">
                    <section class="loader">
                    <div class="slider" style="--i:0"></div>
                    <div class="slider" style="--i:1"></div>
                    <div class="slider" style="--i:2"></div>
                    <div class="slider" style="--i:3"></div>
                    <div class="slider" style="--i:4"></div>
                    </section>
                </div>
            `;

            expenses = [];
            
            // Load expenses from each project's expenses node
            for (const project of allProjects) {
                try {
                    const snapshot = await database.ref(`projects/${project.id}/expenses`).once('value');
                    const projectExpenses = snapshot.val();
                    
                    if (projectExpenses) {
                        for (const expenseId in projectExpenses) {
                            const expense = projectExpenses[expenseId];
                            expense.id = expenseId;
                            expense.projectId = project.id;
                            expense.projectName = project.name;
                            expenses.push(expense);
                        }
                    }
                } catch (error) {
                    console.warn(`Error loading expenses for project ${project.id}:`, error);
                }
            }
            
            // Sort by date (newest first)
            expenses.sort((a, b) => new Date(b.date) - new Date(a.date));
            filteredExpenses = [...expenses];

            displayExpenses();
            updateStats();

        } catch (error) {
            console.error("Error loading expenses:", error);
            document.getElementById('expensesList').innerHTML = `
                <div class="text-center py-4 text-danger">
                    <i class="fas fa-exclamation-triangle fa-2x mb-2"></i>
                    <h5>Error loading expenses</h5>
                    <p class="text-muted">${error.message}</p>
                    <button class="btn btn-primary mt-2" onclick="loadExpenses()">
                        <i class="fas fa-redo me-1"></i>Retry
                    </button>
                </div>
            `;
        }
    }

    // Display expenses in cards
    function displayExpenses() {
        const expensesList = document.getElementById('expensesList');
        
        if (filteredExpenses.length === 0) {
            expensesList.innerHTML = `
                <div class="text-center py-5">
                    <i class="fas fa-receipt fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No expenses found</h5>
                    <p class="text-muted">Add your first expense using the "Add Expense" button</p>
                </div>
            `;
            return;
        }

        let html = '';
        
        filteredExpenses.forEach(expense => {
            const date = new Date(expense.date).toLocaleDateString('en-IN');
            
            html += `
                <div class="card col-md-4 col-lg-3 mb-2 mt-2">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h5 class="card-title mb-1"><i class="fas fa-receipt"></i> ${escapeHtml(expense.title)}</h5>
                                <h6 class="text-primary mb-2">₹ ${formatCurrency(expense.amount)}</h6>
                            </div>
                        </div>
                        
                        <div class="row mb-0">
                            <div class="col-md-6">
                                <p class="mb-1"><i class="fas fa-calendar text-muted me-2"></i>Date: ${date}</p>
                                <p class="mb-1"><i class="fas fa-project-diagram text-muted me-2"></i>Project: ${escapeHtml(expense.projectName || 'N/A')}</p>
                            </div>
                        </div>
                        
                        ${expense.remarks ? `
                        <div class="mb-0">
                            <p class="mb-0"><strong>Remarks:</strong> ${escapeHtml(expense.remarks)}</p>
                        </div>
                        ` : ''}
                        
                        <div class="d-flex justify-content-end gap-2">
                            <button class="btn btn-sm btn-outline-warning" onclick="editExpense('${expense.projectId}', '${expense.id}')">
                                <i class="fas fa-edit me-1"></i>Edit
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteExpense('${expense.projectId}', '${expense.id}')">
                                <i class="fas fa-trash me-1"></i>Delete
                            </button>
                        </div>
                    </div>
                </div>
            `;
        });

        expensesList.innerHTML = html;
    }

    // Save expense
    async function saveExpense() {
        try {
            const form = document.getElementById('expenseForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const expenseData = {
                title: document.getElementById('expenseTitle').value.trim(),
                amount: parseFloat(document.getElementById('expenseAmount').value),
                date: document.getElementById('expenseDate').value,
                remarks: document.getElementById('expenseRemarks').value.trim(),
            };

            const projectId = document.getElementById('expenseProject').value;
            
            // Validate project selection
            if (!projectId) {
                showNotification('Please select a project', 'warning');
                return;
            }

            // Check if user has access to this project
            const hasAccess = await checkProjectAccess(projectId);
            if (!hasAccess) {
                showNotification('You do not have access to this project', 'danger');
                return;
            }

            // Save to Firebase under projects/{projectId}/expenses
            const newExpenseRef = database.ref(`projects/${projectId}/expenses`).push();
            await newExpenseRef.set(expenseData);

            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('addExpenseModal'));
            modal.hide();

            // Refresh expenses list
            await loadExpenses();
            
            // Show success message
            showNotification('Expense added successfully!', 'success');

        } catch (error) {
            console.error("Error saving expense:", error);
            showNotification('Error saving expense: ' + error.message, 'danger');
        }
    }

    // Check if user has access to project
    async function checkProjectAccess(projectId) {
        try {
            if (currentUserRole === 'admin') return true;
            
            const userSnapshot = await database.ref(`users/${currentUser.uid}/projects/${projectId}`).once('value');
            return userSnapshot.val() === true;
        } catch (error) {
            console.error("Error checking project access:", error);
            return false;
        }
    }

    // Edit expense
    async function editExpense(projectId, expenseId) {
        try {
            const snapshot = await database.ref(`projects/${projectId}/expenses/${expenseId}`).once('value');
            const expense = snapshot.val();
            
            if (!expense) {
                showNotification('Expense not found', 'warning');
                return;
            }

            // Check if user has permission to edit
            if (currentUserRole !== 'admin') {
                // For regular users, we'll allow editing since we don't track who added it
                // Or you can add a simple check if needed
            }

            // Populate form
            document.getElementById('expenseTitle').value = expense.title;
            document.getElementById('expenseAmount').value = expense.amount;
            document.getElementById('expenseDate').value = expense.date;
            document.getElementById('expenseRemarks').value = expense.remarks || '';
            document.getElementById('expenseProject').value = projectId;

            // Change modal title and save button
            document.querySelector('#addExpenseModal .modal-title').textContent = 'Edit Expense';
            const saveBtn = document.querySelector('#addExpenseModal .btn-primary');
            saveBtn.textContent = 'Update Expense';
            saveBtn.onclick = function() { updateExpense(projectId, expenseId); };

            // Disable project selection for editing
            document.getElementById('expenseProject').disabled = true;

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('addExpenseModal'));
            modal.show();

        } catch (error) {
            console.error("Error editing expense:", error);
            showNotification('Error loading expense for editing', 'danger');
        }
    }

    // Update expense
    async function updateExpense(projectId, expenseId) {
        try {
            const form = document.getElementById('expenseForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const expenseData = {
                title: document.getElementById('expenseTitle').value.trim(),
                amount: parseFloat(document.getElementById('expenseAmount').value),
                date: document.getElementById('expenseDate').value,
                remarks: document.getElementById('expenseRemarks').value.trim()
            };

            // Update in Firebase
            await database.ref(`projects/${projectId}/expenses/${expenseId}`).update(expenseData);

            // Close modal and reset form
            const modal = bootstrap.Modal.getInstance(document.getElementById('addExpenseModal'));
            modal.hide();
            form.reset();
            document.getElementById('expenseDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('expenseProject').disabled = false;

            // Reset modal title and button
            document.querySelector('#addExpenseModal .modal-title').textContent = 'Add New Expense';
            const saveBtn = document.querySelector('#addExpenseModal .btn-primary');
            saveBtn.textContent = 'Save Expense';
            saveBtn.onclick = function() { saveExpense(); };

            // Refresh expenses list
            await loadExpenses();
            
            // Show success message
            showNotification('Expense updated successfully!', 'success');

        } catch (error) {
            console.error("Error updating expense:", error);
            showNotification('Error updating expense: ' + error.message, 'danger');
        }
    }

    // Delete expense
    async function deleteExpense(projectId, expenseId) {
        try {
            if (!confirm('Are you sure you want to delete this expense? This action cannot be undone.')) {
                return;
            }

            // Check if user has permission to delete
            if (currentUserRole !== 'admin') {
                // For regular users, we'll allow deleting since we don't track who added it
                // Or you can add a simple check if needed
            }

            // Delete from Firebase
            await database.ref(`projects/${projectId}/expenses/${expenseId}`).remove();

            // Refresh expenses list
            await loadExpenses();
            
            // Show success message
            showNotification('Expense deleted successfully!', 'success');

        } catch (error) {
            console.error("Error deleting expense:", error);
            showNotification('Error deleting expense: ' + error.message, 'danger');
        }
    }

    // Apply filters
    function applyFilters() {
        const projectFilter = document.getElementById('filterProject').value;
        const categoryFilter = document.getElementById('filterCategory').value;
        const dateFrom = document.getElementById('filterDateFrom').value;
        const dateTo = document.getElementById('filterDateTo').value;

        currentFilters = {
            projectId: projectFilter,
            category: categoryFilter,
            dateFrom: dateFrom,
            dateTo: dateTo
        };

        filteredExpenses = expenses.filter(expense => {
            // Project filter
            if (projectFilter && expense.projectId !== projectFilter) return false;
            
            // Category filter
            if (categoryFilter && expense.category !== categoryFilter) return false;
            
            // Date range filter
            if (dateFrom && new Date(expense.date) < new Date(dateFrom)) return false;
            if (dateTo && new Date(expense.date) > new Date(dateTo)) return false;
            
            return true;
        });

        displayExpenses();
        updateStats();
    }

    // Reset filters
    function resetFilters() {
        document.getElementById('filterProject').value = '';
        document.getElementById('filterCategory').value = '';
        document.getElementById('filterDateFrom').value = '';
        document.getElementById('filterDateTo').value = '';
        
        currentFilters = {};
        filteredExpenses = [...expenses];
        
        displayExpenses();
        updateStats();
    }

    // Update statistics
    function updateStats() {
        const today = new Date().toISOString().split('T')[0];
        const currentMonth = new Date().getMonth();
        const currentYear = new Date().getFullYear();
        
        let total = 0;
        let todayTotal = 0;
        let monthTotal = 0;
        
        filteredExpenses.forEach(expense => {
            const amount = parseFloat(expense.amount) || 0;
            total += amount;
            
            // Today's expenses
            if (expense.date === today) {
                todayTotal += amount;
            }
            
            // Current month expenses
            const expenseDate = new Date(expense.date);
            if (expenseDate.getMonth() === currentMonth && expenseDate.getFullYear() === currentYear) {
                monthTotal += amount;
            }
        });
        
        document.getElementById('totalExpenses').textContent = '₹ ' + formatCurrency(total);
        document.getElementById('todayExpenses').textContent = '₹ ' + formatCurrency(todayTotal);
        document.getElementById('monthlyExpenses').textContent = '₹ ' + formatCurrency(monthTotal);
    }

    // Export to Excel
    function exportToExcel() {
        if (filteredExpenses.length === 0) {
            showNotification('No expenses to export', 'warning');
            return;
        }
        
        // Create CSV content
        let csv = 'Date,Title,Project,Category,Amount,Receipt No,Remarks\n';
        
        filteredExpenses.forEach(expense => {
            const date = new Date(expense.date).toLocaleDateString('en-IN');
            
            csv += `"${date}",`;
            csv += `"${expense.title.replace(/"/g, '""')}",`;
            csv += `"${(expense.projectName || '').replace(/"/g, '""')}",`;
            csv += `"${getCategoryText(expense.category)}",`;
            csv += `"${formatCurrency(expense.amount)}",`;
            csv += `"${expense.receiptNo || ''}",`;
            csv += `"${(expense.remarks || '').replace(/"/g, '""')}"\n`;
        });
        
        // Create download link
        const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        const url = URL.createObjectURL(blob);
        
        link.setAttribute('href', url);
        link.setAttribute('download', `expenses_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showNotification('Export started successfully', 'success');
    }

    // Refresh expenses
    async function refreshExpenses() {
        await loadExpenses();
        showNotification('Expenses list refreshed', 'info');
    }



    function formatCurrency(amount) {
        return parseFloat(amount).toLocaleString('en-IN', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    }

    function escapeHtml(text) {
        if (!text) return '';
        const div = document.createElement('div');
        div.textContent = text;
        return div.innerHTML;
    }

    // Show notification
    function showNotification(message, type) {
        // Remove existing notifications
        document.querySelectorAll('.alert-notification').forEach(el => el.remove());
        
        const notification = document.createElement('div');
        notification.className = `alert alert-${type} alert-dismissible fade show position-fixed alert-notification`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 300px;';
        notification.innerHTML = `
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            ${message}
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 3000);
    }
</script>

<!-- Bootstrap JS Bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>